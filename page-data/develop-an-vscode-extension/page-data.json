{"componentChunkName":"component---src-templates-blog-post-js","path":"/develop-an-vscode-extension","result":{"data":{"markdownRemark":{"html":"<h2>开发准备</h2>\n<ul>\n<li>阅读 vscode 的文档，但是目前只有英文文档，看起来比较吃力。<a href=\"http://code.visualstudio.com/docs\">文档地址</a></li>\n<li>阅读七牛云 SDK 文档，这个比较简单。<a href=\"http://developer.qiniu.com/code/v6/sdk/nodejs.html\">文档地址</a></li>\n<li>\n<p>安装两个工具：<code class=\"language-text\">yo</code> / <code class=\"language-text\">generator-code</code></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install -g yo generator-code</code></pre></div>\n</li>\n<li>打开 VSCode</li>\n</ul>\n<h2>目录结构</h2>\n<ul>\n<li>\n<p>生成目录结构：<code class=\"language-text\">yo code</code> ， 目录大概会是这样子：</p>\n<p><img src=\"http://oaz5uxplb.bkt.clouddn.com/blog/ext-structure.png\" alt=\"structure\"></p>\n</li>\n</ul>\n<p><strong>package.json</strong> 插件配置文件</p>\n<p><strong>extension.js</strong> 插件入口文件</p>\n<h2>package.json</h2>\n<p>其实开发 vscode 插件时，这个 <code class=\"language-text\">package.json</code> 是非常重要的，它不仅包含了常规的 npm 配置，也包含着 vscode 的诸多配置。</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">// 插件入口文件</span>\n<span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./extension\"</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token comment\">// 插件何时会被激活，在此设置为当打开一个 markdown 文件时激活插件</span>\n<span class=\"token property\">\"activationEvents\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"onLanguage:markdown\"</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n<span class=\"token property\">\"contributes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 快捷键绑定，在此绑定为 `Ctrl + Q N` ，要注意并不是 `Ctrl + Q + N`</span>\n  <span class=\"token property\">\"keybindings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"command\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"extension.qiniu\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ctrl+q n\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"mac\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cmd+q n\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"linux\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ctrl+q n\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"when\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"editorTextFocus &amp;&amp; editorLangId == 'markdown'\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">//包含你的插件的配置选项，可以在 `file > preferences > User Settings` 下更改</span>\n  <span class=\"token property\">\"configuration\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"qiniu cloud configuration\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"qiniu.enable\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"boolean\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"default\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"是否开启七牛上传插件\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"qiniu.AccessKey\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"default\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"七牛云 > 个人面板 > 密钥管理 > AK\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"qiniu.SecretKey\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"default\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"七牛云 > 个人面板 > 密钥管理 > SK\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"qiniu.bucket\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"default\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"任意一个空间名称\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"qiniu.remotePath\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"default\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"qiniu.domin\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"default\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"与空间名称对应的空间域名\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>extension.js</h2>\n<p>由于图床插件比较简单，所以我把所有的代码都写在主入口文件 <code class=\"language-text\">extension.js</code> 中</p>\n<ol>\n<li>首先要在项目中安装七牛 SDK</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save qiniu</code></pre></div>\n<ol start=\"2\">\n<li>导入关键模块，<code class=\"language-text\">vscode &amp; qiniu</code> ，<code class=\"language-text\">vscode</code> 中包含了我们所需的所有的接口，而 <code class=\"language-text\">qiniu</code> 模块则负责主要的上传工作</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> vscode <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'vscode'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> qiniu <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'qiniu'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"3\">\n<li>\n<p>注册一个调用插件的方法，当然这个方法要与 <code class=\"language-text\">package.json</code> 里的相对应</p>\n<p><strong>package.json</strong></p>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"command\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"extension.qiniu\"</span></code></pre></div>\n<p><strong>extension.js</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> disposable <span class=\"token operator\">=</span> vscode<span class=\"token punctuation\">.</span>commands<span class=\"token punctuation\">.</span><span class=\"token function\">registerCommand</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'extension.qiniu'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"4\">\n<li>获取用户的配置</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> vscode<span class=\"token punctuation\">.</span>workspace<span class=\"token punctuation\">.</span><span class=\"token function\">getConfiguration</span><span class=\"token punctuation\">(</span><span class=\"token string\">'qiniu'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"5\">\n<li>开发过程中用到的其他的接口</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 在顶部显示一个输入框，获取文件路径</span>\nvscode<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">.</span><span class=\"token function\">showInputBox</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  placeHolder<span class=\"token operator\">:</span>\n    <span class=\"token string\">'请输入上传到七牛云空间后的文件名，可以包含前缀，例如：blog/name.png'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 在顶部显示上传成功的信息</span>\nvscode<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">.</span><span class=\"token function\">showInformationMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'上传成功！'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 获取用户当前光标位置，并在光标后插入返回的 markdown 图片链接</span>\n<span class=\"token keyword\">let</span> editor <span class=\"token operator\">=</span> vscode<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">.</span>activeTextEditor<span class=\"token punctuation\">;</span>\neditor<span class=\"token punctuation\">.</span><span class=\"token function\">edit</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">textEditorEdit</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  textEditorEdit<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>editor<span class=\"token punctuation\">.</span>selection<span class=\"token punctuation\">.</span>active<span class=\"token punctuation\">,</span> image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ol start=\"6\">\n<li>具体上传图片的业务流程代码可以参考七牛云的官方文档，<a href=\"http://developer.qiniu.com/code/v6/sdk/nodejs.html\">文档地址</a></li>\n</ol>\n<h2>存在的问题</h2>\n<ul>\n<li>在输入本地图片路径是，没有验证图片路径的有效与否</li>\n<li>\n<p>弹出的第二个输入框是用于输入上传至七牛空间之后的文件名称，这个由于暂时没有设置默认名称，因此必须填写，格式如下，可省略文件类型：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">前缀/文件名称\nprefix/file-name\nblog/test</code></pre></div>\n</li>\n<li>目前功能尚不完整，有待继续增强。</li>\n</ul>\n<h2>如何安装使用</h2>\n<h3>安装</h3>\n<p>在 vscode 中，<code class=\"language-text\">Ctrl + Shift + P</code> ，然后 <code class=\"language-text\">ext install qiniu-fig-bed</code></p>\n<h3>使用</h3>\n<p>打开 <code class=\"language-text\">markdown</code> 文件，然后 <code class=\"language-text\">Ctrl + Q N</code> ，要注意不是 <code class=\"language-text\">Ctrl + Q + N</code> ，在状态栏会有提示</p>\n<h2>Github</h2>\n<p><a href=\"https://github.com/coderfe/qiniu-fig-bed\">qiniu-fig-bed</a></p>\n<h2>更新</h2>\n<blockquote>\n<p>2016.11.14 在上传代码中引入 node 的 fs 模块来获取文件类型，因此上传文件的时候可直接省略文件类型名称</p>\n</blockquote>","tableOfContents":"<ul>\n<li><a href=\"/develop-an-vscode-extension/#%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87\">开发准备</a></li>\n<li><a href=\"/develop-an-vscode-extension/#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84\">目录结构</a></li>\n<li><a href=\"/develop-an-vscode-extension/#packagejson\">package.json</a></li>\n<li><a href=\"/develop-an-vscode-extension/#extensionjs\">extension.js</a></li>\n<li><a href=\"/develop-an-vscode-extension/#%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98\">存在的问题</a></li>\n<li>\n<p><a href=\"/develop-an-vscode-extension/#%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8\">如何安装使用</a></p>\n<ul>\n<li><a href=\"/develop-an-vscode-extension/#%E5%AE%89%E8%A3%85\">安装</a></li>\n<li><a href=\"/develop-an-vscode-extension/#%E4%BD%BF%E7%94%A8\">使用</a></li>\n</ul>\n</li>\n<li><a href=\"/develop-an-vscode-extension/#github\">Github</a></li>\n<li><a href=\"/develop-an-vscode-extension/#%E6%9B%B4%E6%96%B0\">更新</a></li>\n</ul>","frontmatter":{"path":"/develop-an-vscode-extension","date":"Oct 26, 2016","title":"VSCode 插件开发——七牛图床工具","tldr":"已经接近一个月没有更新博客文章了，可能是因为太懒了，也可能是比较忙。这段时间开始用 Visual Studio Code 进行开发，感觉它确实比其他编辑器更快、更轻，但唯一的缺点就是插件生态不是那么成熟。那么自己动手，丰衣足食。","tags":["VSCode"]},"timeToRead":3}},"pageContext":{"next":{"frontmatter":{"title":"微信小程序——知乎日报","path":"/wechat-app-first-look"}},"previous":{"frontmatter":{"title":"道阻且长：我的 2016","path":"/2016"}},"relatedPosts":[]}}}