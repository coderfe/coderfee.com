{"componentChunkName":"component---src-templates-blog-post-js","path":"/gatsby/add-rss-feed","result":{"data":{"markdownRemark":{"html":"<h2>报错</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">error on line 2025 at column 11: PCDATA invalid Char value 8</code></pre></div>\n<h2>原因</h2>\n<p>并非所有的 utf-8 有效字符都会被 XML 接受，因此在解析的过程中要将某些特殊字符移除。</p>\n<h2>解决方案</h2>\n<p>把 <code class=\"language-text\">gatsby-plugin-feed</code> 插件的 <code class=\"language-text\">serialize</code> 方法替换为以下方法：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// gatsby-config.js</span>\n<span class=\"token function-variable function\">serialize</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> query<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> site<span class=\"token punctuation\">,</span> allMarkdownRemark <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> allMarkdownRemark<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">edge</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      description<span class=\"token operator\">:</span> edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>tldr<span class=\"token punctuation\">,</span>\n      date<span class=\"token operator\">:</span> edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">,</span>\n      url<span class=\"token operator\">:</span> site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token punctuation\">.</span>siteUrl <span class=\"token operator\">+</span> edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">,</span>\n      guid<span class=\"token operator\">:</span> site<span class=\"token punctuation\">.</span>siteMetadata<span class=\"token punctuation\">.</span>siteUrl <span class=\"token operator\">+</span> edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">,</span>\n      custom_elements<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          <span class=\"token string\">'content:encoded'</span><span class=\"token operator\">:</span> edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>\n            <span class=\"token regex\">/[^\\x09\\x0A\\x0D\\x20-\\xFF\\x85\\xA0-\\uD7FF\\uE000-\\uFDCF\\uFDE0-\\uFFFD]/gm</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">''</span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>其中，真正起作用的是这段正则替换：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">html<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>\n  <span class=\"token regex\">/[^\\x09\\x0A\\x0D\\x20-\\xFF\\x85\\xA0-\\uD7FF\\uE000-\\uFDCF\\uFDE0-\\uFFFD]/gm</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">''</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","tableOfContents":"<ul>\n<li><a href=\"/gatsby/add-rss-feed/#%E6%8A%A5%E9%94%99\">报错</a></li>\n<li><a href=\"/gatsby/add-rss-feed/#%E5%8E%9F%E5%9B%A0\">原因</a></li>\n<li><a href=\"/gatsby/add-rss-feed/#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\">解决方案</a></li>\n</ul>","frontmatter":{"path":"/gatsby/add-rss-feed","date":"Nov 23, 2019","title":"如何解决 Gatsby.js 添加 RSS 报错问题？","tldr":"解决 Gatsby.js 博客添加 RSS 后可能报错的问题","tags":["Gatsby","RSS"]},"timeToRead":1}},"pageContext":{"next":{"frontmatter":{"title":"如何在 Gatsby.js 中使用 BizCharts？","path":"/gatsby/use-bizcharts-in-gatsby"}},"previous":{"frontmatter":{"title":"2019 读书小结","path":"/2019/reading"}},"relatedPosts":[{"next":{"frontmatter":{"title":"『书』擦去眼泪，如同掸去身上的稻草","path":"/read-think/huozhe-xusanguan"}},"previous":{"frontmatter":{"title":"如何解决 Gatsby.js 添加 RSS 报错问题？","path":"/gatsby/add-rss-feed"}},"node":{"frontmatter":{"path":"/gatsby/use-bizcharts-in-gatsby","tags":["Gatsby","可视化"],"title":"如何在 Gatsby.js 中使用 BizCharts？"}}}]}}}