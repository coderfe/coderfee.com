{"componentChunkName":"component---src-templates-blog-post-js","path":"/gatsby/use-bizcharts-in-gatsby","result":{"data":{"markdownRemark":{"html":"<p><a href=\"https://bizcharts.net/index\" target=\"_blank\" rel=\"noopner noreferrer\">BizCharts</a> 是阿里前端团队开源的一款基于 React 开发的数据可视化框架。今天上午想给<a href=\"https://coderfee.com/year\">博客书单</a>加一个数据统计的功能，便引入了 BizCharts，但在编译的时候出现了 <code class=\"language-text\">document not defined</code> 的错误，这是服务端渲染模式下的典型问题。</p>\n<h2>解决过程</h2>\n<p>我的博客是基于 Gatsby.js 开发的，所以我想它肯定会做对应的处理，参见<a href=\"https://www.gatsbyjs.org/docs/debugging-html-builds/#fixing-third-party-modules\" target=\"_blank\" rel=\"noopner noreferrer\">文档</a>，在 <code class=\"language-text\">gatsby-node.js</code> 中加入以下代码：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateWebpackConfig</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> stage<span class=\"token punctuation\">,</span> loaders<span class=\"token punctuation\">,</span> actions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>stage <span class=\"token operator\">===</span> <span class=\"token string\">'build-html'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    actions<span class=\"token punctuation\">.</span><span class=\"token function\">setWebpackConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      module<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        rules<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            test<span class=\"token operator\">:</span> <span class=\"token regex\">/bizcharts/</span><span class=\"token punctuation\">,</span>\n            use<span class=\"token operator\">:</span> loaders<span class=\"token punctuation\">.</span><span class=\"token function\">null</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>但奇怪的是问题没有解决。</p>\n<p>于是经过几分钟的 Google，终于在 GitHub 上找到了一个 <a href=\"https://github.com/antvis/g2/issues/296\" target=\"_blank\" rel=\"noopner noreferrer\">issue</a>，它的做法是使用环境变量来判断是否处于客户端，如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> bizcharts<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>browser<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  bizcharts <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bizcharts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//...</span>\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>bizcharts<span class=\"token punctuation\">.</span>Chart <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">//...</span></code></pre></div>","tableOfContents":"<ul>\n<li><a href=\"/gatsby/use-bizcharts-in-gatsby/#%E8%A7%A3%E5%86%B3%E8%BF%87%E7%A8%8B\">解决过程</a></li>\n</ul>","frontmatter":{"path":"/gatsby/use-bizcharts-in-gatsby","date":"Nov 23, 2019","title":"如何在 Gatsby.js 中使用 BizCharts？","tldr":"BizCharts 踩坑记录：Gatsby.js 在服务端渲染（SSR）模式下使用 BizCharts","tags":["Gatsby","可视化"]},"timeToRead":1}},"pageContext":{"next":{"frontmatter":{"title":"『书』擦去眼泪，如同掸去身上的稻草","path":"/read-think/huozhe-xusanguan"}},"previous":{"frontmatter":{"title":"如何解决 Gatsby.js 添加 RSS 报错问题？","path":"/gatsby/add-rss-feed"}},"relatedPosts":[{"next":{"frontmatter":{"title":"如何在 Gatsby.js 中使用 BizCharts？","path":"/gatsby/use-bizcharts-in-gatsby"}},"previous":{"frontmatter":{"title":"2019 读书小结","path":"/2019/reading"}},"node":{"frontmatter":{"path":"/gatsby/add-rss-feed","tags":["Gatsby","RSS"],"title":"如何解决 Gatsby.js 添加 RSS 报错问题？"}}}]}}}