---
title: 『书』编写可读代码的艺术
date: 2020-06-21
path: '/books/clean-code'
tldr: 可读性基本定理：代码的写法应当使别人理解它的时间最小化。
tags: ['读书笔记']
cover: './clean-code.jpg'
---

## 🔨 表面层次的改进

表层的改进意味着我们要让代码变得更漂亮、更整洁、命名更加容易理解。有的人可能认为一个命名而已，随便起一个就行，我见过太多的重复命名和后缀加数字 1234 的命名了，如果没有注释会让阅读代码的人不明所以。

### 命名

首先使用专业的词汇来命名，如果是业务代码，就需要我们熟悉业务，结合专业术语进行考量；如果是底层框架代码，那么就应该使用业界通用的命名规则，并不需要独创一套规则，清晰和明确优于有趣。其次选择的词汇要避免二义性，也即容易造成歧义的词汇，这个原则需要我们多去审视自己的代码和业务逻辑，我最常犯的错误是使用 disable 来命名布尔值；第三点是考虑代码逻辑上下文，恰当使用 tmp 这类泛泛的词汇，如果代码行数少且切逻辑明确，使用这类词汇无伤大雅，反之则不然，需要老老实实取一个容易理解的名字。

### 💄 审美

这里的审美不是编辑器的主题颜色，而是对代码美的追求，例如对齐、格式化、一致性。

为什么需要审美？代码是写给人的而并非机器的，人们天然的喜欢有规则的，一致性的事物。我见过很多代码，很乱，根本没有美感可言，即使很啰嗦的一段代码，如果把它用规则的方法整理之后，至少看起来不会让人觉得糟心。

作者提出的等号对齐方式，如果用现代编辑器去做自动格式化是很容易的，但是我不太喜欢。

```javascript
details  = request.post.get('details');
location = request.post.get('location');
phone    = equest.post.get('phone');
email    = request.post.get('email');
url      = request.POST.get('url');
```

用方法来整理不规则的东西，这一条简直深得我心，最近做的项目重复代码高的令人发指，如果用一个方法来整理这些重复代码，那后续的修改简直易如反掌。其实现在的 IDE 对这个问题很有帮助，它会智能提示重复逻辑，并给出修改建议。

代码的顺序即思考的顺序，作者的意思应该是用一种有意义的顺序来组织代码，例如变量就应该出现在离使用它最近的地方、从最重要到最不重要的次序。但我还想到一点就是异步，如果利用得当，异步是一种效率很高的方式，但遗憾的是很多时候人们会搞混它的顺序，而且不自知。

个人风格和一致性。编程领域请遵循少数服从多数的编码风格，否则可能会因为 Tab or Space 而争论不休。

### 📝 注释

好代码 > 坏代码 + 好注释。好的代码不需要注释，但是我们应该站在阅读代码的人的角度去思考如何帮助他们更快地理解代码。

尽管人们强调写注释的重要性，但我们应该清楚何时不需要注释。首先那些显而易见也就是从上下文就可以轻松理解意图的代码是无需注释的。其次是约定俗成的编码方式或某些常量（例如 PI 等）无需注释。坏代码无需注释，你要做的是尽量去优化代码或者为它取一个更好的名字。

既然决定要写注释，那么我们就应该思考如何写注释。注释对于代码作者来说是一种思考过程，是关于这段代码做了什么以及怎么做的思考；对于阅读者而言，注释的意义更甚，无需通过了解具体代码逻辑，如果仅凭注释和命名就能推断代码意图，那么这段注释就是好的注释。因此站在作者的角度来说，我们应当根据场景写出这段代码做了什么、是怎么做的等内在性或原理性的注释；对于读者来说，他们更想知道的是这段代码可能会出现什么问题、如何解决，他们并不想关注细节。

## 🎈 简化循环和逻辑

### 简化控制流

作者提到了如何优化条件控制语句，其中有一个概念叫做『尤达表示法』：

```javascript
// 正常写法
if (obj === null) {
}

// 尤达表示法
if (null === obj) {
}
```

这种写法虽然不会出错，但对于可读性来说没有任何帮助，因此不太赞成使用。

还有一个比较细节的技巧，`if` 条件中把频繁改变的值放在等号左边，不变的或变动频率小的值放在等号右边，这样可以减少阅读代码时的思维跳跃。

其它一些小技巧：

1. 避免使用 `do while` 循环
2. `if else` 语句的顺序
   - 先处理正逻辑，后处理副逻辑
   - 先处理简单逻辑，后处理复杂逻辑
3. 函数中提早返回
4. 最小化嵌套代码，可以将嵌套逻辑转化为线性逻辑

### 拆分超长表达式

大多数人同时只能考虑 3-4 件事情，因此在编码过程中应当把超长的表达是拆分为更容易理解的小块，一个函数只做一件事就是这个道理。

拆分表达式要考虑的第一件事儿就是引入变量（删除变量或者引入变量取决于具体场景，但都是为可读性服务），作者提到了两种类型的变量，分别是解释性变量和总结性变量，也可以理解为子表达式，用简单的变量来代替上下文中超长的代码块会让代码更容易理解和管理，一次改动，多处生效。

反向思考，当对于一段逻辑的思考越来越复杂的时候，转换一下思考角度也许能让复杂的事情简单化，可能需要我们把问题『反向』或者站在目标的对立面去思考。

## ⛓ 重新组织代码

所谓工程学就是关于把大问题拆分成小问题再把这些问题的解决方案放回一起，这个原则同样适用于解决工作中的问题，也即任务分解。

![](%E7%BC%96%E5%86%99%E5%8F%AF%E8%AF%BB%E4%BB%A3%E7%A0%81%E7%9A%84%E8%89%BA%E6%9C%AF/%E7%85%A7%E7%89%87%202020%E5%B9%B46%E6%9C%8820%E6%97%A5%20085013.jpg)

### 抽取不相关的子问题

什么是不相关的子问题？按照我的理解是一段代码中过于复杂的逻辑、和当前代码不在一个层次的逻辑、工具类函数、通用功能等等都可以成为不相关的子问题，这段逻辑抽取之后，并不影响整体逻辑，可以使一个方法的所有操作都保持在同一个抽象层次，这样一来读者就可以只关注整体，而不必纠结于具体细节。

### 少写代码

『最好读的代码是没有代码』。很理想，但这一点可能无法用在实际项目中，紧迫的开发时间不会给你足够的时间去思考，大多时候我们要做的事情就是堆砌代码，直到系统能够正常运行，循环往复……再优秀的代码都会被拉入无尽的深坑之中。但程序员还是应该有自己的坚持，做一个会偷懒的人，就像经典库 jQuery 标榜的那样：Write Less Do More。

那如何才能做到少写代码呢？

1. 遵循上述原则，写出优秀的代码
2. 消除不必要的功能，避免过度设计
3. 重新考虑需求，简化之
4. 提升对于语言 API 的熟悉度，利用之
5. 删除无用代码，而非注释掉，保持精简

## 👨‍💻 最后

代码是写给人看的，记住这个原则，那么写出来的代码的可读性基本不会差，其它原则需要刻意练习以及日复一日的坚持，形成一个写出可读性代码的意识，拒绝给机器写代码，它又看不懂。
